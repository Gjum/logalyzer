#!/bin/bash
# Rescans all logfiles of today, i.e. *.log.gz and latest.log,
# or all existing logfiles if the -f switch is provided (force rescan).

source utils

force=false # true to rescan all logfiles, false to rescan only today

OPTIND=1
while getopts "f" arg; do
	case $arg in
		f) force=true ;;
	esac
done

if $force; then
	dates=`for logfile in $logfilespath/*.log.gz; do
		echo "$logfile" | grep -oE '[[:digit:]-]{10}'
	done | uniq`
fi

dates+=" `date +%Y-%m-%d`"

# scan the compressed logfiles
for date in $dates; do
	echo Scanning "$date"...
	./scan-day "$date" > "$logfilespath/$date$suffix"
done

exit 0

