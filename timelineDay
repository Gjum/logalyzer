#!/usr/bin/env python3

from datetime import datetime, timedelta
from time import strftime
import logalyzer
import timeline
import sys

if len(sys.argv) <= 2:
    print('Usage: %s <path/to/logs> <png_path> [<day> | [<from-date> <to-date>]]' % sys.argv[0])
    print('    date format is "YYYY-MM-DD" or "YYYY-MM-DD HH:MM:SS", get timeline from...')
    print('    - no dates: last 24h,')
    print('    - day only: times during that day,')
    print('    - from and to: time between from and to, to is exclusive')
    sys.exit(0)
logs = logalyzer.LogDirectory(sys.argv[1])
img_path = sys.argv[2]

from_date = strftime('%Y-%m-%d %H:%M:%S')
if len(sys.argv) > 3:
    from_date = logalyzer.ensure_full_date(sys.argv[3])
to_date = strftime('%Y-%m-%d %H:%M:%S', (datetime.strptime(from_date, '%Y-%m-%d %H:%M:%S') + timedelta(days=1)).timetuple())
if len(sys.argv) > 4:
    to_date = logalyzer.ensure_full_date(sys.argv[4])

im_width = 1000
title = from_date

draw_data = timeline.get_draw_data(logs, from_date, to_date)
timeline.draw_timeline(draw_data, img_path, im_width, title)
